window.__require=function e(t,i,n){function s(o,c){if(!i[o]){if(!t[o]){var a=o.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!c&&l)return l(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+o+"'")}}var h=i[o]={exports:{}};t[o][0].call(h.exports,function(e){return s(t[o][1][e]||e)},h,h.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof __require&&__require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function r(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function c(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,r,a,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(c(i=this._events[e]))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),i.apply(this,r)}else if(o(i))for(r=Array.prototype.slice.call(arguments,1),n=(l=i.slice()).length,a=0;a<n;a++)l[a].apply(this,r);return!0},n.prototype.addListener=function(e,t){var i;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=c(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!s(t))throw TypeError("listener must be a function");var i=!1;function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var i,n,r,c;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(i=this._events[e]).length,n=-1,i===t||s(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(i)){for(c=r;c-- >0;)if(i[c]===t||i[c].listener&&i[c].listener===t){n=c;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],EventEmitter:[function(e,t,i){"use strict";cc._RF.push(t,"bd2fbmzQTZEvo/NQ27uQrKC","EventEmitter");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=e("events"),o=function(){function e(){s(this,e),this._emitter=new r,this._emitter.setMaxListeners(100)}return n(e,[{key:"emit",value:function(){var e;(e=this._emitter).emit.apply(e,arguments)}},{key:"registerEvent",value:function(e,t){this._emitter.on(e,t)}},{key:"registerOnce",value:function(e,t){this._emitter.once(e,t)}},{key:"removeEvent",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"destroy",value:function(){this._emitter.removeAllListeners(),this._emitter=null,e.instance=null}}]),e}();o.instance=null,t.exports=o,cc._RF.pop()},{events:1}],Panel:[function(e,t,i){"use strict";cc._RF.push(t,"6501fGe4qBI3qBFv3wLpWgj","Panel"),cc.Class({extends:cc.Component,properties:{tutorialPanel:cc.Node},open:function(){this.tutorialPanel.active=!0},close:function(){this.tutorialPanel.active=!1}}),cc._RF.pop()},{}],block:[function(e,t,i){"use strict";cc._RF.push(t,"0bfacG98vtB9auBWYKR5Q6/","block"),cc.Class({extends:cc.Component,properties:{skin:cc.Node,textValue:cc.Label,efxLabel:cc.Label,anim:cc.Animation},setTile:function(e){this.skin.color=cc.color(e.skin),this.textValue.string=e.text,this.textValue.node.color=cc.color(e.textColor),this.efxLabel.string=e.text},mergeAnim:function(){this.anim.play("merge")}}),cc._RF.pop()},{}],board:[function(e,t,i){"use strict";cc._RF.push(t,"ba464FXyshB66sGqfBz/YEe","board");var n=e("gConfig"),s=e("EventEmitter"),r=e("eventCode");cc.Class({extends:cc.Component,properties:{boardPos:cc.Node,spawnPoint:cc.Node,blockPrefab:cc.Prefab},onLoad:function(){this.board=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],s.instance.registerEvent(r.INIT_BOARD,this.init.bind(this))},init:function(){this.board=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],this.spawnPoint.removeAllChildren()},spawnBlock:function(e,t,i){var n=cc.instantiate(this.blockPrefab);n.getComponent("block").setTile(this.getTileSkin(i)),this.board[e][t]=n,n.parent=this.spawnPoint,n.position=this.getPos(e,t)},moveAction:function(e,t,i,n,o){s.instance.emit(r.SET_LIMIT,!1),cc.tween(this.board[e][t]).to(.15,{position:this.getPos(i,n)}).call(o&&o()).start(),this.board[i][n]=this.board[e][t],this.board[e][t]=null},mergeAction:function(e,t,i,n,s){var r=this.board[e][t].getComponent("block"),o=this.board[i][n];r.setTile(this.getTileSkin(s)),r.mergeAnim(),o.destroy()},getPos:function(e,t){var i={x:this.boardPos.children[e].children[t].position.x,y:this.boardPos.children[e].position.y};return cc.v2(i.x,i.y)},getTileSkin:function(e){return n.TILE_SKIN[e]}}),cc._RF.pop()},{EventEmitter:"EventEmitter",eventCode:"eventCode",gConfig:"gConfig"}],eventCode:[function(e,t,i){"use strict";cc._RF.push(t,"f7705tWOadFv5f0YgH/QXg6","eventCode"),t.exports={INPUT_A:"inputA",INPUT_D:"inputD",INPUT_W:"inputW",INPUT_S:"inputS",WIN:"onWin",LOSE:"onLose",UPDATE_SCORE:"updateScore",INIT_BOARD:"initBoard",INIT_GRID:"initGRID",SET_LIMIT:"setLimit"},cc._RF.pop()},{}],gConfig:[function(e,t,i){"use strict";cc._RF.push(t,"51f8cKvYSVJUojB/CfOHGan","gConfig"),t.exports={TILE_SKIN:{2:{skin:"#EEE4DA",text:"2",textColor:"#000000"},4:{skin:"#E4C5A7",text:"4",textColor:"#000000"},8:{skin:"#6D9BE0",text:"8",textColor:"#FFFFFF"},16:{skin:"#74E786",text:"16",textColor:"#FFFFFF"},32:{skin:"#9042F3",text:"32",textColor:"#FFFFFF"},64:{skin:"#E65AE6",text:"64",textColor:"#FFFFFF"},128:{skin:"#D38D5E",text:"128",textColor:"#FFFFFF"},256:{skin:"#42C9F3",textColor:"#FFFFFF",text:"256"},512:{skin:"#D11F1F",textColor:"#FFFFFF",text:"512"},1024:{skin:"#F8F85B",textColor:"#FFFFFF",text:"1024"},2048:{skin:"#1A7A02",textColor:"#FFFFFF",text:"2048"},4096:{skin:"#392D79",textColor:"#FFFFFF",text:"4096"}}},cc._RF.pop()},{}],grid:[function(e,t,i){"use strict";var n;function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}cc._RF.push(t,"7ed47daPWhACYI0QGD6ZIKn","grid");var r=e("EventEmitter"),o=e("eventCode");cc.Class((s(n={extends:cc.Component,properties:{board:e("board"),_isLimit:!1},onLoad:function(){this.init(),r.instance.registerEvent(o.INIT_GRID,this.init.bind(this)),r.instance.registerEvent(o.SET_LIMIT,this.setLimit.bind(this))},init:function(){this.grid=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this._isLimit=!1,this.createTile(),this._isLimit=!1,this.createTile()},slideLeft:function(){for(var e=0;e<4;e++){var t=this.grid[e];this.changeDirection(t,e,"left")}this.createTile()},slideRight:function(){for(var e=0;e<4;e++){var t=this.grid[e];this.changeDirection(t,e,"right")}this.createTile()}},"slideRight",function(){for(var e=0;e<4;e++){var t=this.grid[e];this.changeDirection(t,e,"right")}this.createTile()}),s(n,"slideUp",function(){for(var e=0;e<4;e++){var t=[this.grid[0][e],this.grid[1][e],this.grid[2][e],this.grid[3][e]];this.changeDirection(t,e,"up")}this.createTile()}),s(n,"slideDown",function(){for(var e=0;e<4;e++){var t=[this.grid[0][e],this.grid[1][e],this.grid[2][e],this.grid[3][e]];this.changeDirection(t,e,"down")}this.createTile()}),s(n,"changeDirection",function(e,t,i){switch(i){case"left":this.slide(e,t,1,0),this.merge(e,t,1,0);break;case"right":this.slide(e,t,-1,0),this.merge(e,t,-1,0);break;case"up":this.slide(e,t,1,1),this.merge(e,t,1,1);break;case"down":this.slide(e,t,-1,1),this.merge(e,t,-1,1)}}),s(n,"slide",function(e,t,i,n){for(var s=0,r=function(t){return i>0?t<e.length:t>=0},o=i>0?0:e.length-1;r(o);o+=i)if(0===e[o])s++;else{var c=o-s*i,a=[e[o],e[c]];if(e[c]=a[0],e[o]=a[1],0!==s)if(0===n)this.board.moveAction(t,o,t,c);else{for(var l=0;l<e.length;l++)this.grid[l][t]=e[l];this.board.moveAction(o,t,c,t)}}}),s(n,"merge",function(e,t,i,n){for(var s=this,c=0,a=function(t){return i>0?t<e.length:t>=0},l=function(a){var l=a+1*i;if(e[a]===e[l]&&0!==e[a])if(e[a]*=2,e[l]=0,r.instance.emit(o.UPDATE_SCORE,e[a]),0===n)s.board.moveAction(t,l,t,a,function(){s.board.mergeAction(t,l,t,a,e[a])});else{for(var h=0;h<e.length;h++)s.grid[h][t]=e[h];s.board.moveAction(l,t,a,t,function(){s.board.mergeAction(l,t,a,t,e[a])})}if(0===e[a])c++;else{var u=a-c*i,f=[e[a],e[u]];if(e[u]=f[0],e[a]=f[1],0!==c)if(0===n)s.board.moveAction(t,a,t,u);else{for(var v=0;v<e.length;v++)s.grid[v][t]=e[v];s.board.moveAction(a,t,u,t)}}},h=i>0?0:e.length-1;a(h);h+=i)l(h)}),s(n,"createTile",function(){if(!this.checkWin()&&(this.checkEmpty()||this.checkGameOver())&&this.checkEmpty()&&!this._isLimit){for(var e=!1;!e;){var t=Math.floor(4*Math.random()),i=Math.floor(4*Math.random()),n=Math.random()>.8?4:2;0==this.grid[t][i]&&(this.grid[t][i]=n,this.board.spawnBlock(t,i,n),e=!0)}this._isLimit=!0}}),s(n,"checkEmpty",function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)if(0===this.grid[e][t])return!0;return!1}),s(n,"checkGameOver",function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)if(e>0&&this.grid[e][t]===this.grid[e-1][t]||e<3&&this.grid[e][t]===this.grid[e+1][t]||t>0&&this.grid[e][t]===this.grid[e][t-1]||t<3&&this.grid[e][t]===this.grid[e][t+1])return!0;return r.instance.emit(o.LOSE),!1}),s(n,"checkWin",function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)if(2048===this.grid[e][t])return r.instance.emit(o.WIN),!0;return!1}),s(n,"setLimit",function(e){this._isLimit=e}),n)),cc._RF.pop()},{EventEmitter:"EventEmitter",board:"board",eventCode:"eventCode"}],inputHandler:[function(e,t,i){"use strict";cc._RF.push(t,"96cafvaojBPRJbHdmObufMu","inputHandler");var n=e("EventEmitter"),s=e("eventCode");cc.Class({extends:cc.Component,properties:{_isPress:!1},onLoad:function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},onKeyDown:function(e){if(!this._isPress)switch(this._isPress=!0,e.keyCode){case cc.macro.KEY.a:n.instance.emit(s.INPUT_A);break;case cc.macro.KEY.d:n.instance.emit(s.INPUT_D);break;case cc.macro.KEY.w:n.instance.emit(s.INPUT_W);break;case cc.macro.KEY.s:n.instance.emit(s.INPUT_S)}},onKeyUp:function(){var e=this;this.scheduleOnce(function(){e._isPress=!1},.2)}}),cc._RF.pop()},{EventEmitter:"EventEmitter",eventCode:"eventCode"}],mainController:[function(e,t,i){"use strict";cc._RF.push(t,"e5417+wkeRDcKb5C0sMAJOW","mainController");var n=e("EventEmitter"),s=e("eventCode");cc.Class({extends:cc.Component,properties:{grid:e("grid"),winPanel:cc.Node,losePanel:cc.Node,newGamePoll:cc.Node,startPanel:cc.Node,scoreText:cc.Label,bestText:cc.Label,_scoreValue:0,_bestValue:0,_isLock:!1},onLoad:function(){n.instance=new n,n.instance.registerEvent(s.INPUT_A,this.slideA.bind(this)),n.instance.registerEvent(s.INPUT_D,this.slideD.bind(this)),n.instance.registerEvent(s.INPUT_W,this.slideW.bind(this)),n.instance.registerEvent(s.INPUT_S,this.slideS.bind(this)),n.instance.registerOnce(s.WIN,this.onWin.bind(this)),n.instance.registerOnce(s.LOSE,this.onLose.bind(this)),n.instance.registerEvent(s.UPDATE_SCORE,this.updateScore.bind(this)),this.loadData()},newGame:function(){this._isLock=!0,this.newGamePoll.active=!0},startGame:function(){this.startPanel.active=!1,this.yesNEW()},yesNEW:function(){this._isLock=!1,this.newGamePoll.active=!1,this._scoreValue=0,this.scoreText.string=0,n.instance.emit(s.INIT_BOARD),n.instance.emit(s.INIT_GRID),this.winPanel.active=!1,this.losePanel.active=!1},noNEW:function(){this._isLock=!1,this.newGamePoll.active=!1,this.winPanel.active=!1,this.losePanel.active=!1},slideA:function(){this._isLock||this.grid.slideLeft()},slideD:function(){this._isLock||this.grid.slideRight()},slideW:function(){this._isLock||this.grid.slideUp()},slideS:function(){this._isLock||this.grid.slideDown()},onWin:function(){this._isLock=!0,this.winPanel.active=!0},onLose:function(){this._isLock=!0,this.losePanel.active=!0},updateScore:function(e){this._scoreValue+=e,this.scoreText.string=this._scoreValue,this._scoreValue>=this._bestValue&&(this._bestValue=this._scoreValue,this.bestText.string=this._bestValue,this.saveData())},saveData:function(){var e={name:"a",score:this._bestValue};cc.sys.localStorage.setItem("playerInfo",JSON.stringify(e))},loadData:function(){var e=cc.sys.localStorage.getItem("playerInfo");if(cc.log("====  loadData  ======"),null!==e){var t=JSON.parse(e);cc.log("data",t),this._bestValue=t.score,this.bestText.string=this._bestValue}}}),cc._RF.pop()},{EventEmitter:"EventEmitter",eventCode:"eventCode",grid:"grid"}],mathf:[function(e,t,i){"use strict";cc._RF.push(t,"a09d7mHpLlN9YNkoRqVDphx","mathf"),t.exports={random:function(e){return Math.floor(Math.random()*e)},checkEmpty:function(e){for(var t=0;t<4;t++)for(var i=0;i<4;i++)if(0===e[t][i])return!0;return!1}},cc._RF.pop()},{}]},{},["Panel","block","board","inputHandler","mainController","gConfig","grid","EventEmitter","eventCode","mathf"]);