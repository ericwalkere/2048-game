window.__require=function t(e,n,i){function s(o,a){if(!n[o]){if(!e[o]){var c=o.split("/");if(c=c[c.length-1],!e[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+o+"'")}}var u=n[o]={exports:{}};e[o][0].call(u.exports,function(t){return s(e[o][1][t]||t)},u,u.exports,t,e,n,i)}return n[o].exports}for(var r="function"==typeof __require&&__require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(t,e,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function r(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!r(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,n,i,r,c,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}if(a(n=this._events[t]))return!1;if(s(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),n.apply(this,r)}else if(o(n))for(r=Array.prototype.slice.call(arguments,1),i=(h=n.slice()).length,c=0;c<i;c++)h[c].apply(this,r);return!0},i.prototype.addListener=function(t,e){var n;if(!s(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(n=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){if(!s(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var n,i,r,a;if(!s(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=(n=this._events[t]).length,i=-1,n===e||s(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(a=r;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(s(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(s(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){(function(t,i){"object"==typeof n&&"object"==typeof e?e.exports=i():"function"==typeof define&&define.amd?define("StateMachine",[],i):"object"==typeof n?n.StateMachine=i():t.StateMachine=i()})(this,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";t.exports=function(t,e){var n,i,s;for(n=1;n<arguments.length;n++)for(s in i=arguments[n])i.hasOwnProperty(s)&&(t[s]=i[s]);return t}},function(t,e,n){"use strict";var i=n(0);t.exports={build:function(t,e){var n,s,r,o=e.plugins;for(n=0,s=o.length;n<s;n++)(r=o[n]).methods&&i(t,r.methods),r.properties&&Object.defineProperties(t,r.properties)},hook:function(t,e,n){var i,s,r,o,a=t.config.plugins,c=[t.context];for(n&&(c=c.concat(n)),i=0,s=a.length;i<s;i++)o=a[i],(r=a[i][e])&&r.apply(o,c)}}},function(t,e,n){"use strict";function i(t){if(0===t.length)return t;var e,n,i=t.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return t;for(n=i[0].toLowerCase(),e=1;e<i.length;e++)n=n+i[e].charAt(0).toUpperCase()+i[e].substring(1).toLowerCase();return n}i.prepended=function(t,e){return t+(e=i(e))[0].toUpperCase()+e.substring(1)},t.exports=i},function(t,e,n){"use strict";var i=n(0),s=n(2);function r(t,e){t=t||{},this.options=t,this.defaults=e.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(t.init),this.data=this.configureData(t.data),this.methods=this.configureMethods(t.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(t.transitions||[]),this.plugins=this.configurePlugins(t.plugins,e.plugin)}i(r.prototype,{addState:function(t){this.map[t]||(this.states.push(t),this.addStateLifecycleNames(t),this.map[t]={})},addStateLifecycleNames:function(t){this.lifecycle.onEnter[t]=s.prepended("onEnter",t),this.lifecycle.onLeave[t]=s.prepended("onLeave",t),this.lifecycle.on[t]=s.prepended("on",t)},addTransition:function(t){this.transitions.indexOf(t)<0&&(this.transitions.push(t),this.addTransitionLifecycleNames(t))},addTransitionLifecycleNames:function(t){this.lifecycle.onBefore[t]=s.prepended("onBefore",t),this.lifecycle.onAfter[t]=s.prepended("onAfter",t),this.lifecycle.on[t]=s.prepended("on",t)},mapTransition:function(t){var e=t.name,n=t.from,i=t.to;return this.addState(n),"function"!=typeof i&&this.addState(i),this.addTransition(e),this.map[n][e]=t,t},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(t){return"string"==typeof t?this.mapTransition(i({},this.defaults.init,{to:t,active:!0})):"object"==typeof t?this.mapTransition(i({},this.defaults.init,t,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(t){return"function"==typeof t?t:"object"==typeof t?function(){return t}:function(){return{}}},configureMethods:function(t){return t||{}},configurePlugins:function(t,e){var n,i,s;for(n=0,i=(t=t||[]).length;n<i;n++)"function"==typeof(s=t[n])&&(t[n]=s=s()),s.configure&&s.configure(this);return t},configureTransitions:function(t){var e,n,i,s,r,o=this.defaults.wildcard;for(n=0;n<t.length;n++)for(i=t[n],s=Array.isArray(i.from)?i.from:[i.from||o],r=i.to||o,e=0;e<s.length;e++)this.mapTransition({name:i.name,from:s[e],to:r})},transitionFor:function(t,e){var n=this.defaults.wildcard;return this.map[t][e]||this.map[n][e]},transitionsFor:function(t){var e=this.defaults.wildcard;return Object.keys(this.map[t]).concat(Object.keys(this.map[e]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),t.exports=r},function(t,e,n){var i=n(0),s=n(6),r=n(1),o=[null,[]];function a(t,e){this.context=t,this.config=e,this.state=e.init.from,this.observers=[t]}i(a.prototype,{init:function(t){if(i(this.context,this.config.data.apply(this.context,t)),r.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(t){return Array.isArray(t)?t.indexOf(this.state)>=0:this.state===t},isPending:function(){return this.pending},can:function(t){return!this.isPending()&&!!this.seek(t)},cannot:function(t){return!this.can(t)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(t,e){var n=this.config.defaults.wildcard,i=this.config.transitionFor(this.state,t),s=i&&i.to;return"function"==typeof s?s.apply(this.context,e):s===n?this.state:s},fire:function(t,e){return this.transit(t,this.state,this.seek(t,e),e)},transit:function(t,e,n,i){var s=this.config.lifecycle,r=this.config.options.observeUnchangedState||e!==n;return n?this.isPending()?this.context.onPendingTransition(t,e,n):(this.config.addState(n),this.beginTransit(),i.unshift({transition:t,from:e,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(s.onBefore.transition),this.observersForEvent(s.onBefore[t]),r?this.observersForEvent(s.onLeave.state):o,r?this.observersForEvent(s.onLeave[e]):o,this.observersForEvent(s.on.transition),r?["doTransit",[this]]:o,r?this.observersForEvent(s.onEnter.state):o,r?this.observersForEvent(s.onEnter[n]):o,r?this.observersForEvent(s.on[n]):o,this.observersForEvent(s.onAfter.transition),this.observersForEvent(s.onAfter[t]),this.observersForEvent(s.on[t])],i)):this.context.onInvalidTransition(t,e,n)},beginTransit:function(){this.pending=!0},endTransit:function(t){return this.pending=!1,t},failTransit:function(t){throw this.pending=!1,t},doTransit:function(t){this.state=t.to},observe:function(t){if(2===t.length){var e={};e[t[0]]=t[1],this.observers.push(e)}else this.observers.push(t[0])},observersForEvent:function(t){for(var e,n=0,i=this.observers.length,s=[];n<i;n++)(e=this.observers[n])[t]&&s.push(e);return[t,s,!0]},observeEvents:function(t,e,n,i){if(0===t.length)return this.endTransit(void 0===i||i);var s=t[0][0],o=t[0][1],a=t[0][2];if(e[0].event=s,s&&a&&s!==n&&r.hook(this,"lifecycle",e),0===o.length)return t.shift(),this.observeEvents(t,e,s,i);var c=o.shift(),h=c[s].apply(c,e);return h&&"function"==typeof h.then?h.then(this.observeEvents.bind(this,t,e,s)).catch(this.failTransit.bind(this)):!1===h?this.endTransit(!1):this.observeEvents(t,e,s,h)},onInvalidTransition:function(t,e,n){throw new s("transition is invalid in current state",t,e,n,this.state)},onPendingTransition:function(t,e,n){throw new s("transition is invalid while previous transition is still in progress",t,e,n,this.state)}}),t.exports=a},function(t,e,n){"use strict";var i=n(0),s=n(2),r=n(1),o=n(3),a=n(4),c={is:function(t){return this._fsm.is(t)},can:function(t){return this._fsm.can(t)},cannot:function(t){return this._fsm.cannot(t)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(t,e,n){return this._fsm.onInvalidTransition(t,e,n)},onPendingTransition:function(t,e,n){return this._fsm.onPendingTransition(t,e,n)}},h={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(t){throw Error("use transitions to change state")}}};function u(t){return f(this||{},t)}function f(t,e){return l(t,new o(e,u)),t._fsm(),t}function l(t,e){if("object"!=typeof t||Array.isArray(t))throw Error("StateMachine can only be applied to objects");r.build(t,e),Object.defineProperties(t,h),i(t,c),i(t,e.methods),e.allTransitions().forEach(function(e){t[s(e)]=function(){return this._fsm.fire(e,[].slice.call(arguments))}}),t._fsm=function(){this._fsm=new a(this,e),this._fsm.init(arguments)}}u.version="3.0.1",u.factory=function(){var t,e;"function"==typeof arguments[0]?(t=arguments[0],e=arguments[1]||{}):(t=function(){this._fsm.apply(this,arguments)},e=arguments[0]||{});var n=new o(e,u);return l(t.prototype,n),t.prototype._fsm.config=n,t},u.apply=f,u.defaults={wildcard:"*",init:{name:"init",from:"none"}},t.exports=u},function(t,e,n){"use strict";t.exports=function(t,e,n,i,s){this.message=t,this.transition=e,this.from=n,this.to=i,this.current=s}}])})},{}],EventEmitter:[function(t,e,n){"use strict";cc._RF.push(e,"bd2fbmzQTZEvo/NQ27uQrKC","EventEmitter");var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=t("events"),o=function(){function t(){s(this,t),this._emitter=new r,this._emitter.setMaxListeners(100)}return i(t,[{key:"emit",value:function(){var t;(t=this._emitter).emit.apply(t,arguments)}},{key:"registerEvent",value:function(t,e){this._emitter.on(t,e)}},{key:"registerOnce",value:function(t,e){this._emitter.once(t,e)}},{key:"removeEvent",value:function(t,e){this._emitter.removeListener(t,e)}},{key:"destroy",value:function(){this._emitter.removeAllListeners(),this._emitter=null,t.instance=null}}]),t}();o.instance=null,e.exports=o,cc._RF.pop()},{events:1}],MainFSM:[function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}cc._RF.push(e,"e9148y46NRINYi7tQq/PGFr","MainFSM");var s=t("javascript-state-machine"),r=(t("EventEmitter"),t("eventCode"),"goStart"),o="goInput",a="goMoving",c="goNew",h="goWin",u="goLose",f="start",l="waitingInput",v="movingBLock",d="newGame",p="win",m="lose",g=cc.Class({extends:cc.Component,properties:{_fsm:null},initStateMachine:function(){this._fsm=new s({init:f,transitions:[{name:r,from:d,to:f},{name:o,from:f,to:l},{name:o,from:v,to:l},{name:a,from:l,to:v},{name:h,from:"*",to:p},{name:u,from:"*",to:m},{name:c,from:"*",to:d}],methods:{onInvalidTransition:function(){for(var t,e=arguments.length,n=Array(e),s=0;s<e;s++)n[s]=arguments[s];(t=console).trace.apply(t,["invalid"].concat(i(n)))}}})},onInput:function(){cc.log("onInput")},onMoving:function(){cc.log("onMoving")},onWin:function(){cc.log("onWin")},onLose:function(){cc.log("onLose")},isStateInput:function(){return this._fsm.state===l},isStateMoving:function(){return this._fsm.state===v},isStateWin:function(){return this._fsm.state===p},isStateLose:function(){return this._fsm.state===m}});g.instance=null,e.exports=g,cc._RF.pop()},{EventEmitter:"EventEmitter",eventCode:"eventCode","javascript-state-machine":2}],Panel:[function(t,e,n){"use strict";cc._RF.push(e,"6501fGe4qBI3qBFv3wLpWgj","Panel"),cc.Class({extends:cc.Component,properties:{tutorialPanel:cc.Node},open:function(){this.tutorialPanel.active=!0},close:function(){this.tutorialPanel.active=!1}}),cc._RF.pop()},{}],block:[function(t,e,n){"use strict";cc._RF.push(e,"0bfacG98vtB9auBWYKR5Q6/","block"),cc.Class({extends:cc.Component,properties:{skin:cc.Node,textValue:cc.Label,efxLabel:cc.Label,anim:cc.Animation},setTile:function(t){this.skin.color=cc.color(t.skin),this.textValue.string=t.text,this.textValue.node.color=cc.color(t.textColor),this.efxLabel.string=t.text},mergeAnim:function(){this.anim.play("merge")}}),cc._RF.pop()},{}],board:[function(t,e,n){"use strict";cc._RF.push(e,"ba464FXyshB66sGqfBz/YEe","board");var i=t("gConfig"),s=t("EventEmitter"),r=t("eventCode");cc.Class({extends:cc.Component,properties:{boardPos:cc.Node,spawnPoint:cc.Node,blockPrefab:cc.Prefab},onLoad:function(){this.board=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],s.instance.registerEvent(r.INIT_BOARD,this.init.bind(this))},init:function(){this.board=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],this.spawnPoint.removeAllChildren()},spawnBlock:function(t,e,n){var i=cc.instantiate(this.blockPrefab);i.getComponent("block").setTile(this.getTileSkin(n)),this.board[t][e]=i,i.parent=this.spawnPoint,i.position=this.getPos(t,e)},moveAction:function(t,e,n,i,o){s.instance.emit(r.SET_LIMIT,!1),cc.tween(this.board[t][e]).to(.15,{position:this.getPos(n,i)}).call(o&&o()).start(),this.board[n][i]=this.board[t][e],this.board[t][e]=null},mergeAction:function(t,e,n,i,s){var r=this.board[t][e].getComponent("block"),o=this.board[n][i];r.setTile(this.getTileSkin(s)),r.mergeAnim(),o.destroy()},getPos:function(t,e){var n={x:this.boardPos.children[t].children[e].position.x,y:this.boardPos.children[t].position.y};return cc.v2(n.x,n.y)},getTileSkin:function(t){return i.TILE_SKIN[t]}}),cc._RF.pop()},{EventEmitter:"EventEmitter",eventCode:"eventCode",gConfig:"gConfig"}],eventCode:[function(t,e,n){"use strict";cc._RF.push(e,"f7705tWOadFv5f0YgH/QXg6","eventCode"),e.exports={INPUT_A:"inputA",INPUT_D:"inputD",INPUT_W:"inputW",INPUT_S:"inputS",WIN:"onWin",LOSE:"onLose",UPDATE_SCORE:"updateScore",INIT_BOARD:"initBoard",INIT_GRID:"initGRID",SET_LIMIT:"setLimit"},cc._RF.pop()},{}],gConfig:[function(t,e,n){"use strict";cc._RF.push(e,"51f8cKvYSVJUojB/CfOHGan","gConfig"),e.exports={TILE_SKIN:{2:{skin:"#EEE4DA",text:"2",textColor:"#000000"},4:{skin:"#E4C5A7",text:"4",textColor:"#000000"},8:{skin:"#6D9BE0",text:"8",textColor:"#FFFFFF"},16:{skin:"#74E786",text:"16",textColor:"#FFFFFF"},32:{skin:"#9042F3",text:"32",textColor:"#FFFFFF"},64:{skin:"#E65AE6",text:"64",textColor:"#FFFFFF"},128:{skin:"#D38D5E",text:"128",textColor:"#FFFFFF"},256:{skin:"#42C9F3",textColor:"#FFFFFF",text:"256"},512:{skin:"#D11F1F",textColor:"#FFFFFF",text:"512"},1024:{skin:"#F8F85B",textColor:"#FF0000",text:"1024"},2048:{skin:"#1A7A02",textColor:"#FF0000",text:"2048"},4096:{skin:"#392D79",textColor:"#FFFFFF",text:"4096"}}},cc._RF.pop()},{}],grid:[function(t,e,n){"use strict";var i;function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}cc._RF.push(e,"7ed47daPWhACYI0QGD6ZIKn","grid");var r=t("EventEmitter"),o=t("eventCode");cc.Class((s(i={extends:cc.Component,properties:{board:t("board"),_isLimit:!1},onLoad:function(){this.init(),r.instance.registerEvent(o.INIT_GRID,this.init.bind(this)),r.instance.registerEvent(o.SET_LIMIT,this.setLimit.bind(this))},init:function(){this.grid=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this._isLimit=!1,this.createTile(),this._isLimit=!1,this.createTile()},slideLeft:function(){for(var t=0;t<4;t++){var e=this.grid[t];this.changeDirection(e,t,"left")}this.createTile()},slideRight:function(){for(var t=0;t<4;t++){var e=this.grid[t];this.changeDirection(e,t,"right")}this.createTile()}},"slideRight",function(){for(var t=0;t<4;t++){var e=this.grid[t];this.changeDirection(e,t,"right")}this.createTile()}),s(i,"slideUp",function(){for(var t=0;t<4;t++){var e=[this.grid[0][t],this.grid[1][t],this.grid[2][t],this.grid[3][t]];this.changeDirection(e,t,"up")}this.createTile()}),s(i,"slideDown",function(){for(var t=0;t<4;t++){var e=[this.grid[0][t],this.grid[1][t],this.grid[2][t],this.grid[3][t]];this.changeDirection(e,t,"down")}this.createTile()}),s(i,"changeDirection",function(t,e,n){switch(n){case"left":this.slide(t,e,1,0),this.merge(t,e,1,0);break;case"right":this.slide(t,e,-1,0),this.merge(t,e,-1,0);break;case"up":this.slide(t,e,1,1),this.merge(t,e,1,1);break;case"down":this.slide(t,e,-1,1),this.merge(t,e,-1,1)}}),s(i,"slide",function(t,e,n,i){for(var s=0,r=function(e){return n>0?e<t.length:e>=0},o=n>0?0:t.length-1;r(o);o+=n)if(0===t[o])s++;else{var a=o-s*n,c=[t[o],t[a]];if(t[a]=c[0],t[o]=c[1],0!==s)if(0===i)this.board.moveAction(e,o,e,a);else{for(var h=0;h<t.length;h++)this.grid[h][e]=t[h];this.board.moveAction(o,e,a,e)}}}),s(i,"merge",function(t,e,n,i){for(var s=this,a=0,c=function(e){return n>0?e<t.length:e>=0},h=function(c){var h=c+1*n;if(t[c]===t[h]&&0!==t[c])if(t[c]*=2,t[h]=0,r.instance.emit(o.UPDATE_SCORE,t[c]),0===i)s.board.moveAction(e,h,e,c,function(){s.board.mergeAction(e,h,e,c,t[c])});else{for(var u=0;u<t.length;u++)s.grid[u][e]=t[u];s.board.moveAction(h,e,c,e,function(){s.board.mergeAction(h,e,c,e,t[c])})}if(0===t[c])a++;else{var f=c-a*n,l=[t[c],t[f]];if(t[f]=l[0],t[c]=l[1],0!==a)if(0===i)s.board.moveAction(e,c,e,f);else{for(var v=0;v<t.length;v++)s.grid[v][e]=t[v];s.board.moveAction(c,e,f,e)}}},u=n>0?0:t.length-1;c(u);u+=n)h(u)}),s(i,"createTile",function(){if(!this.checkWin()&&(this.checkEmpty()||this.checkGameOver())&&this.checkEmpty()&&!this._isLimit){for(var t=!1;!t;){var e=Math.floor(4*Math.random()),n=Math.floor(4*Math.random()),i=Math.random()>.8?4:2;0==this.grid[e][n]&&(this.grid[e][n]=i,this.board.spawnBlock(e,n,i),t=!0)}this._isLimit=!0}}),s(i,"checkEmpty",function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++)if(0===this.grid[t][e])return!0;return!1}),s(i,"checkGameOver",function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++)if(t>0&&this.grid[t][e]===this.grid[t-1][e]||t<3&&this.grid[t][e]===this.grid[t+1][e]||e>0&&this.grid[t][e]===this.grid[t][e-1]||e<3&&this.grid[t][e]===this.grid[t][e+1])return!0;return r.instance.emit(o.LOSE),!1}),s(i,"checkWin",function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++)if(2048===this.grid[t][e])return r.instance.emit(o.WIN),!0;return!1}),s(i,"setLimit",function(t){this._isLimit=t}),i)),cc._RF.pop()},{EventEmitter:"EventEmitter",board:"board",eventCode:"eventCode"}],inputHandler:[function(t,e,n){"use strict";cc._RF.push(e,"96cafvaojBPRJbHdmObufMu","inputHandler");var i=t("EventEmitter"),s=t("eventCode");cc.Class({extends:cc.Component,properties:{_isPress:!1,_touchStartX:0,_touchStartY:0},onLoad:function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},onKeyDown:function(t){if(!this._isPress)switch(this._isPress=!0,t.keyCode){case cc.macro.KEY.a:i.instance.emit(s.INPUT_A);break;case cc.macro.KEY.d:i.instance.emit(s.INPUT_D);break;case cc.macro.KEY.w:i.instance.emit(s.INPUT_W);break;case cc.macro.KEY.s:i.instance.emit(s.INPUT_S)}},onKeyUp:function(){this._isPress=!1},onTouchStart:function(t){this._touchStartX=t.getLocationX(),this._touchStartY=t.getLocationY(),this.isPress=!1},onTouchMove:function(t){var e=t.getLocationX(),n=t.getLocationY(),r=e-this._touchStartX,o=n-this._touchStartY;r>10&&!this.isPress?(this.isPress=!0,i.instance.emit(s.INPUT_D)):r<-10&&!this.isPress?(this.isPress=!0,i.instance.emit(s.INPUT_A)):o>10&&!this.isPress?(this.isPress=!0,i.instance.emit(s.INPUT_W)):o<-10&&!this.isPress&&(this.isPress=!0,i.instance.emit(s.INPUT_S)),this._touchStartX=e,this._touchStartY=n}}),cc._RF.pop()},{EventEmitter:"EventEmitter",eventCode:"eventCode"}],mainController:[function(t,e,n){"use strict";cc._RF.push(e,"e5417+wkeRDcKb5C0sMAJOW","mainController");var i=t("EventEmitter"),s=t("eventCode"),r=t("MainFSM");cc.Class({extends:cc.Component,properties:{grid:t("grid"),winPanel:cc.Node,losePanel:cc.Node,newGamePoll:cc.Node,startPanel:cc.Node,scoreText:cc.Label,bestText:cc.Label,_scoreValue:0,_bestValue:0},onLoad:function(){i.instance=new i,r.instance=new r,r.instance.initStateMachine(),this.registerEventListeners(),this.loadData()},registerEventListeners:function(){i.instance.registerEvent(s.INPUT_A,this.slide.bind(this,"left")),i.instance.registerEvent(s.INPUT_D,this.slide.bind(this,"right")),i.instance.registerEvent(s.INPUT_W,this.slide.bind(this,"up")),i.instance.registerEvent(s.INPUT_S,this.slide.bind(this,"down")),i.instance.registerOnce(s.WIN,this.onWin.bind(this)),i.instance.registerOnce(s.LOSE,this.onLose.bind(this)),i.instance.registerEvent(s.UPDATE_SCORE,this.updateScore.bind(this))},startGame:function(){r.instance._fsm.goInput(),this.startPanel.active=!1},newGame:function(){r.instance._fsm.goNew(),r.instance._fsm.goStart(),this.newGamePoll.active=!0},yesNewGame:function(){r.instance._fsm.goInput(),this.newGamePoll.active=!1,this._scoreValue=0,this.scoreText.string=0,i.instance.emit(s.INIT_BOARD),i.instance.emit(s.INIT_GRID),this.winPanel.active=!1,this.losePanel.active=!1},noNewGame:function(){r.instance._fsm.goInput(),this.newGamePoll.active=!1,this.winPanel.active=!1,this.losePanel.active=!1},slide:function(t){if(!r.instance.isStateWin()&&!r.instance.isStateLose()){switch(r.instance._fsm.goMoving(),t){case"left":this.grid.slideLeft();break;case"right":this.grid.slideRight();break;case"up":this.grid.slideUp();break;case"down":this.grid.slideDown()}r.instance.isStateWin()||r.instance.isStateLose()||r.instance._fsm.goInput()}},onWin:function(){r.instance._fsm.goWin(),this.winPanel.active=!0},onLose:function(){r.instance._fsm.goLose(),this.losePanel.active=!0},updateScore:function(t){this._scoreValue+=t,this.scoreText.string=this._scoreValue,this._scoreValue>=this._bestValue&&(this._bestValue=this._scoreValue,this.bestText.string=this._bestValue,this.saveData())},saveData:function(){var t={name:"a",score:this._bestValue};cc.sys.localStorage.setItem("playerInfo",JSON.stringify(t))},loadData:function(){var t=cc.sys.localStorage.getItem("playerInfo");if(null!==t){var e=JSON.parse(t);this._bestValue=e.score,this.bestText.string=this._bestValue}}}),cc._RF.pop()},{EventEmitter:"EventEmitter",MainFSM:"MainFSM",eventCode:"eventCode",grid:"grid"}],mathf:[function(t,e,n){"use strict";cc._RF.push(e,"a09d7mHpLlN9YNkoRqVDphx","mathf"),e.exports={random:function(t){return Math.floor(Math.random()*t)},checkEmpty:function(t){for(var e=0;e<4;e++)for(var n=0;n<4;n++)if(0===t[e][n])return!0;return!1}},cc._RF.pop()},{}]},{},["Panel","block","board","MainFSM","inputHandler","mainController","gConfig","grid","EventEmitter","eventCode","mathf"]);